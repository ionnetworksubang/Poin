<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>ION Portal App</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
  <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <style>
    :root { --bg-body: #f8fafc; --bg-card: #ffffff; --primary: #2563eb; --admin: #e11d48; --text-main: #334155; --text-muted: #64748b; --border-color: #e2e8f0; }
    * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Plus Jakarta Sans', sans-serif; -webkit-tap-highlight-color: transparent; }
    body { background: var(--bg-body); color: var(--text-main); padding-bottom: 90px; overflow-x: hidden; }
    
    .fullscreen-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100vh; z-index: 9999; display: flex; justify-content: center; align-items: center; flex-direction: column; transition: 0.4s; }
    .fullscreen-overlay.hidden { opacity: 0; visibility: hidden; }
    #loader { background: #0f172a; }
    
    /* LOGIN SCREEN & INPUTS */
    #loginScreen { background: linear-gradient(135deg, #eff6ff 0%, #dbeafe 100%); }
    .login-box { background: white; padding: 40px 25px; border-radius: 28px; width: 90%; max-width: 360px; text-align: center; box-shadow: 0 20px 40px rgba(37, 99, 235, 0.1); }
    .login-box h2 { color: #1e293b; margin-bottom: 25px; font-weight: 800; }
    .input-grp { position: relative; margin-bottom: 16px; }
    .input-grp i.fa-envelope, .input-grp i.fa-lock { position: absolute; left: 16px; top: 50%; transform: translateY(-50%); color: #94a3b8; }
    .input-grp input { width: 100%; padding: 15px 15px 15px 48px; background: #f8fafc; border: 1px solid var(--border-color); border-radius: 14px; outline: none; transition: 0.3s; }
    .input-grp input:focus { border-color: var(--primary); background: white; box-shadow: 0 0 0 4px rgba(37,99,235,0.1); }
    
    /* FITUR MATA PASSWORD */
    .toggle-pass { position: absolute; right: 16px; top: 50%; transform: translateY(-50%); color: #94a3b8; cursor: pointer; font-size: 1.1rem; transition: 0.2s; }
    .toggle-pass:hover { color: var(--primary); }
    .input-grp input[type="password"], .input-grp input[type="text"] { padding-right: 45px; }
    
    .btn-login { width: 100%; padding: 15px; background: var(--primary); border: none; border-radius: 14px; color: white; font-weight: 700; cursor: pointer; transition: 0.3s; }
    
    /* HEADER & LAYOUT UTAMA */
    .top-header { background: linear-gradient(135deg, #1e40af, #2563eb); padding: 25px 20px 50px; color: white; border-bottom-left-radius: 30px; border-bottom-right-radius: 30px; box-shadow: 0 4px 20px rgba(37, 99, 235, 0.15); }
    .user-info h3 { font-size: 1.4rem; font-weight: 700; margin-bottom: 6px; }
    .role-badge { background: rgba(255,255,255,0.2); padding: 5px 14px; border-radius: 20px; font-size: 0.75rem; font-weight: 600; }
    .role-badge.admin { background: var(--admin); }
    
    /* TOMBOL PROFIL ESTETIK */
    .profile-btn { background: rgba(255,255,255,0.2); border: none; color: white; width: 45px; height: 45px; border-radius: 14px; font-size: 1.2rem; cursor: pointer; transition: 0.2s; display: flex; justify-content: center; align-items: center; }
    .profile-btn:active { background: rgba(255,255,255,0.3); transform: scale(0.95); }

    .content-area { margin: -25px 15px 20px; position: relative; z-index: 10; display: none; }
    .content-area.active { display: block; animation: slideIn 0.4s cubic-bezier(0.16, 1, 0.3, 1) forwards; }
    @keyframes slideIn { 0% { opacity: 0; transform: translateX(30px); } 100% { opacity: 1; transform: translateX(0); } }
    
    /* AKSES CEPAT WRAPPER (Perbaikan Ketimpa Warna) */
    .section-header-card { background: white; padding: 15px 20px; border-radius: 16px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); border: 1px solid var(--border-color); margin-bottom: 15px; display: flex; align-items: center; gap: 10px; }

    .menu-grid { display: grid; grid-template-columns: 1fr; gap: 14px; margin-top: 15px; }
    .menu-card { background: var(--bg-card); padding: 20px; border-radius: 20px; display: flex; align-items: center; gap: 18px; text-decoration: none; color: var(--text-main); border: 1px solid var(--border-color); }
    .menu-card .icon-box { width: 50px; height: 50px; border-radius: 14px; display: flex; justify-content: center; align-items: center; font-size: 1.4rem; color: white; }
    .menu-card h4 { font-size: 1.05rem; font-weight: 600; margin-bottom: 4px; }
    .menu-card p { font-size: 0.8rem; color: var(--text-muted); }
    
    .action-container { display: flex; flex-direction: column; gap: 10px; margin-bottom: 18px; }
    .action-row { display: flex; gap: 10px; }
    .search-input { flex: 1; padding: 14px 18px; border-radius: 16px; border: 1px solid var(--border-color); outline: none; }
    .btn-add { background: var(--primary); color: white; border: none; padding: 0 22px; border-radius: 16px; font-weight: 600; cursor: pointer; }
    .data-card { background: white; padding: 18px; border-radius: 18px; margin-bottom: 12px; border: 1px solid var(--border-color); display: flex; justify-content: space-between; align-items: center; cursor: pointer; }
    
    .bottom-nav { position: fixed; bottom: 0; width: 100%; background: white; display: flex; justify-content: space-around; padding: 12px 5px; border-top: 1px solid var(--border-color); z-index: 100; }
    .nav-item { display: flex; flex-direction: column; align-items: center; gap: 6px; color: #94a3b8; font-size: 0.75rem; font-weight: 600; cursor: pointer; }
    .nav-item.active { color: var(--primary); }
    .member-role .admin-only { display: none !important; }
    
    /* MODAL SYSTEM */
    .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100vh; background: rgba(15, 23, 42, 0.6); z-index: 999; opacity: 0; visibility: hidden; }
    .modal-overlay.open { opacity: 1; visibility: visible; }
    .modal-sheet { position: fixed; bottom: -100%; left: 0; width: 100%; max-height: 90vh; background: white; z-index: 1000; border-radius: 28px 28px 0 0; transition: 0.4s; display: flex; flex-direction: column; }
    .modal-sheet.open { bottom: 0; }
    .modal-header { padding: 22px 25px; border-bottom: 1px solid var(--border-color); display: flex; justify-content: space-between; align-items: center; }
    .close-btn { width: 32px; height: 32px; background: #f1f5f9; border-radius: 50%; display: flex; justify-content: center; align-items: center; cursor: pointer; }
    .modal-body { padding: 25px; overflow-y: auto; flex: 1; }
    .form-group { margin-bottom: 18px; }
    .form-group label { display: block; font-size: 0.85rem; font-weight: 600; margin-bottom: 8px; }
    .form-group input, .form-group select, .form-group textarea { width: 100%; padding: 14px; border: 1px solid var(--border-color); border-radius: 12px; outline:none; font-family:inherit;}
    .form-group input:focus, .form-group select:focus, .form-group textarea:focus { border-color: var(--primary); box-shadow: 0 0 0 3px rgba(37,99,235,0.1); }
    .modal-footer { padding: 18px 25px; border-top: 1px solid var(--border-color); display: flex; gap: 12px; }
    .btn-full { flex: 1; padding: 15px; border-radius: 14px; font-weight: 600; color: white; cursor: pointer; border: none; display: flex; justify-content: center; align-items: center; gap: 8px;}
    .btn-save { background: var(--primary); } .btn-delete { background: white; color: var(--admin); border: 1px solid var(--admin); }
  </style>
</head>
<body>
  
  <div id="loader" class="fullscreen-overlay"><i class="fas fa-circle-notch fa-spin" style="font-size: 2.5rem; color: #3b82f6; margin-bottom: 18px;"></i><p style="color: white; font-weight: 600;" id="loaderText">Menyiapkan Sistem...</p></div>
  
  <div id="loginScreen" class="fullscreen-overlay hidden">
    <div class="login-box">
      <div style="background: #eff6ff; width: 80px; height: 80px; border-radius: 50%; display: flex; justify-content: center; align-items: center; margin: 0 auto 20px;">
        <i class="fas fa-network-wired" style="font-size: 2.5rem; color: #3b82f6;"></i>
      </div>
      <h2>ION PORTAL</h2>
      
      <div id="loginErrorMsg" style="color: #ef4444; font-size: 0.85rem; font-weight: 700; margin-bottom: 15px; display: none; background: #fee2e2; padding: 10px; border-radius: 8px; border: 1px solid #fecdd3;">
        <i class="fas fa-exclamation-circle"></i> Email atau Password salah!
      </div>

      <div class="input-grp">
        <i class="fas fa-envelope"></i>
        <input type="email" id="logEmail" placeholder="Email">
      </div>
      <div class="input-grp">
        <i class="fas fa-lock"></i>
        <input type="password" id="logPass" placeholder="Password">
        <i class="fas fa-eye toggle-pass" id="eyeIcon" onclick="togglePassword()"></i>
      </div>
      <button id="btnLogin" class="btn-login" onclick="doLogin()">Masuk Akses</button>
    </div>
  </div>
  
  <div id="appScreen" class="hidden">
    <div class="top-header">
      <div style="display:flex; justify-content:space-between; align-items:center;">
        <div class="user-info">
          <h3 id="userName">Halo, User</h3>
          <span class="role-badge" id="userRole">Member</span>
        </div>
        <button class="profile-btn" onclick="openProfile()"><i class="fas fa-user-cog"></i></button>
      </div>
    </div>
    
    <div id="tab-home" class="content-area active">
      <div class="section-header-card">
        <i class="fas fa-bolt" style="color: #eab308; font-size: 1.2rem;"></i>
        <h4 style="color: #1e293b; font-size: 1.1rem; font-weight: 800; margin: 0;">Akses Cepat</h4>
      </div>

      <div class="menu-grid">
        <a href="instalasi/index.html" class="menu-card"><div class="icon-box" style="background: #eff6ff; color: #2563eb;"><i class="fas fa-file-signature"></i></div><div><h4>Laporan Instalasi</h4><p>Buat laporan pasang baru</p></div></a>
        <a href="terminate/index.html" class="menu-card"><div class="icon-box" style="background: #fffbeb; color: #d97706;"><i class="fas fa-user-minus"></i></div><div><h4>Laporan Terminate</h4><p>Cabut perangkat pelanggan</p></div></a>
        <a href="waPanel.html" class="menu-card"><div class="icon-box" style="background: #ecfdf5; color: #059669;"><i class="fab fa-whatsapp"></i></div><div><h4>Tools WhatsApp</h4><p>Kirim pesan template</p></div></a>
        <a href="odp-manajemen.html" class="menu-card"><div class="icon-box" style="background: #f3e8ff; color: #9333ea;"><i class="fas fa-network-wired"></i></div><div><h4>ODP Manajemen</h4><p>Lihat isi & pindah pelanggan</p></div></a>
        
        <a href="#" class="menu-card admin-only" onclick="openBulkLaporan(); return false;">
          <div class="icon-box" style="background: #fff7ed; color: #ea580c;"><i class="fas fa-paste"></i></div>
          <div><h4>Upload Laporan Masal</h4><p>Paste rekapan WA ke Database</p></div>
        </a>
        <a href="monitoring.html" class="menu-card admin-only">
          <div class="icon-box" style="background: #fdf2f8; color: #db2777;"><i class="fas fa-desktop"></i></div>
          <div><h4>Monitoring Aktivitas</h4><p>Pantau & Edit riwayat input tim</p></div>
        </a>
      </div>
    </div>

    <div id="tab-odp" class="content-area">
      <div class="action-container">
        <div class="action-row"><input type="text" class="search-input" id="searchOdp" placeholder="Cari ODP..." oninput="renderOdp()"><button class="btn-add admin-only" onclick="openModal('odp', 'add')"><i class="fas fa-plus"></i></button><button class="btn-add admin-only" style="background: #10b981;" onclick="openBulkOdp()"><i class="fas fa-file-upload"></i></button></div>
        <select class="search-input" id="filterOdpOlt" onchange="renderOdp()"><option value="">Semua OLT Induk</option></select>
      </div><div id="listOdp"></div>
    </div>

    <div id="tab-olt" class="content-area"><div class="action-row" style="margin-bottom: 18px;"><input type="text" class="search-input" id="searchOlt" placeholder="Cari OLT..." oninput="renderOlt()"><button class="btn-add admin-only" onclick="openModal('olt', 'add')"><i class="fas fa-plus"></i> OLT</button></div><div id="listOlt"></div></div>
    <div id="tab-member" class="content-area admin-only"><div class="action-row" style="margin-bottom: 18px;"><input type="text" class="search-input" id="searchMember" placeholder="Cari Teknisi..." oninput="renderMember()"><button class="btn-add" onclick="openModal('member', 'add')"><i class="fas fa-user-plus"></i> Tim</button></div><div id="listMember"></div></div>
    
    <nav class="bottom-nav">
      <div class="nav-item active" onclick="switchTab('home', this)"><i class="fas fa-home"></i>Home</div>
      <div class="nav-item" onclick="switchTab('odp', this)"><i class="fas fa-box"></i>ODP</div>
      <div class="nav-item" onclick="switchTab('olt', this)"><i class="fas fa-server"></i>OLT</div>
      <div class="nav-item admin-only" onclick="switchTab('member', this)"><i class="fas fa-users"></i>Tim</div>
      <div class="nav-item" onclick="doLogout()"><i class="fas fa-sign-out-alt" style="color:var(--admin);"></i>Keluar</div>
    </nav>
  </div>

  <div class="modal-overlay" id="modalOverlay" onclick="closeModal()"></div>
  <div class="modal-sheet" id="crudModal">
    <div class="modal-header"><h3 id="modalTitle" style="margin:0; font-size:1.15rem; color:#1e293b;">Tambah Data</h3><div class="close-btn" onclick="closeModal()"><i class="fas fa-times"></i></div></div>
    <div class="modal-body" id="modalFormBody"></div>
    <div class="modal-footer admin-only"><button class="btn-full btn-delete" id="btnDelete" onclick="saveData('delete')" style="display:none;"><i class="fas fa-trash-alt"></i> Hapus</button><button class="btn-full btn-save" onclick="saveData('save')"><i class="fas fa-check"></i> Simpan</button></div>
  </div>

  <div class="modal-sheet" id="profileModal">
    <div class="modal-header">
      <h3 style="margin:0; font-size:1.15rem; color:#1e293b;"><i class="fas fa-user-edit" style="color:#2563eb;"></i> Pengaturan Profil</h3>
      <div class="close-btn" onclick="closeModal()"><i class="fas fa-times"></i></div>
    </div>
    <div class="modal-body">
      <div class="form-group">
        <label>Nama Lengkap</label>
        <input type="text" id="profNama">
      </div>
      <div class="form-group">
        <label>Email (Paten / Tidak bisa diganti)</label>
        <input type="email" id="profEmail" disabled style="background:#e2e8f0; color:#64748b; font-weight:600;">
      </div>
      <div class="form-group">
        <label>No HP / WhatsApp</label>
        <input type="tel" id="profHp">
      </div>
      <div class="form-group">
        <label>Password Baru</label>
        <div style="position:relative;">
            <input type="password" id="profPass" placeholder="Kosongkan jika tidak ingin ganti sandi" style="padding-right:45px;">
            <i class="fas fa-eye toggle-pass" id="profEye" onclick="toggleProfPassword()" style="position:absolute; right:15px; top:50%; transform:translateY(-50%); cursor:pointer; color:#94a3b8; font-size: 1.1rem;"></i>
        </div>
      </div>
    </div>
    <div class="modal-footer">
      <button class="btn-full btn-save" onclick="saveProfile()"><i class="fas fa-save"></i> Simpan Profil</button>
    </div>
  </div>

  <div class="modal-sheet" id="bulkModal">
    <div class="modal-header"><h3 style="margin:0; font-size:1.15rem; color:#1e293b;">Upload Massal ODP</h3><div class="close-btn" onclick="closeModal()"><i class="fas fa-times"></i></div></div>
    <div class="modal-body"><div class="form-group"><label>Pilih OLT Induk</label><select id="bulkOltSelect"></select></div><div class="form-group"><label>Daftar Nama ODP (Pisahkan dengan Enter)</label><textarea id="bulkOdpText" rows="8" style="font-family: monospace;"></textarea></div></div>
    <div class="modal-footer"><button class="btn-full btn-save" onclick="saveBulkOdp()"><i class="fas fa-cloud-upload-alt"></i> Upload Sekarang</button></div>
  </div>

  <div class="modal-sheet" id="bulkLaporanModal">
    <div class="modal-header">
      <h3 style="margin:0; font-size:1.15rem; color:#1e293b;">Upload Laporan Masal</h3>
      <div class="close-btn" onclick="closeModal()"><i class="fas fa-times"></i></div>
    </div>
    <div class="modal-body">
      <div class="form-group">
        <label>Paste Format Rekapan WA di sini:</label>
        <textarea id="bulkLaporanText" rows="12" style="font-family: monospace; font-size: 0.85rem;" placeholder="1. A/N : Nama Pelanggan&#10;CID : 123456...&#10;..."></textarea>
      </div>
      <p style="font-size: 0.8rem; color: #64748b; margin-top:-10px;">*Sistem otomatis membaca Nama, CID, OLT, ODP, Port, Perangkat, SN, dan Email.</p>
    </div>
    <div class="modal-footer">
      <button class="btn-full btn-save" onclick="processBulkLaporan()"><i class="fas fa-cloud-upload-alt"></i> Proses & Simpan ke Database</button>
    </div>
  </div>

  <script src="script.js"></script>
</body>
</html>
